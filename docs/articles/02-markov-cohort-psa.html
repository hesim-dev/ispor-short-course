<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Incorporating Probabilistic Sensitivity Analysis • rcea</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Incorporating Probabilistic Sensitivity Analysis">
<meta property="og:description" content="rcea">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rcea</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-markov-cohort.html">Simple Markov Cohort Model</a>
    </li>
    <li>
      <a href="../articles/02-markov-cohort-psa.html">Incorporating Probabilistic Sensitivity Analysis</a>
    </li>
    <li>
      <a href="../articles/03-markov-cohort-hesim.html">Markov Cohort Model with hesim</a>
    </li>
    <li>
      <a href="../articles/04-mstate.html">Semi-Markov Multi-state Model</a>
    </li>
    <li>
      <a href="../articles/05-psm.html">Partitioned Survival Model</a>
    </li>
    <li>
      <a href="../articles/06-cea.html">Cost-effectiveness Analysis</a>
    </li>
    <li class="divider">
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hesim-dev/ispor-short-course/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Incorporating Probabilistic Sensitivity Analysis</h1>
            
            <h4 class="date">2020-09-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hesim-dev/ispor-short-course/blob/master/vignettes/02-markov-cohort-psa.Rmd"><code>vignettes/02-markov-cohort-psa.Rmd</code></a></small>
      <div class="hidden name"><code>02-markov-cohort-psa.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a><span class="header-section-number">1</span> Overview</h1>
<p>Probabilistic sensitivity analysis (PSA) is used to quantify the impact of parameter uncertainty on the uncertainty of model outputs. PSA is typically performed via a simulation approach whereby the model parameters are randomly sampled from suitable probability distributions and the entire model is simulated for each random draw of the parameters.</p>
<p>In this example, we extend the deterministic <a href="01-markov-cohort.html">simple Markov cohort model</a> to incorporate PSA. We will continue to rely primarily on Base <code>R</code> but will use the <code>hesim</code> package to help make the code more readable.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"rcea"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"hesim"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"data.table"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"magrittr"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"ggplot2"</span>)</pre></body></html></div>
</div>
<div id="model-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#model-parameters" class="anchor"></a><span class="header-section-number">2</span> Model parameters</h1>
<div id="transition-probabilities-for-soc" class="section level2">
<h2 class="hasAnchor">
<a href="#transition-probabilities-for-soc" class="anchor"></a><span class="header-section-number">2.1</span> Transition probabilities for SOC</h2>
<p>The probability distribution used for transition probabilities will depend on the underlying data. In this case, we assume that summary level data is available on transitions from the Healthy state (n = 900), Sick state (n = 900), and Sicker state (n = 800). The transitions from each state to the other 4 states can be modeled using a Dirichlet distribution (see Appendix).</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">transitions_soc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">848</span>, <span class="fl">150</span>, <span class="fl">0</span>,   <span class="fl">2</span>,
    <span class="fl">450</span>, <span class="fl">355</span>, <span class="fl">95</span>,  <span class="fl">5</span>,
    <span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">784</span>, <span class="fl">16</span>,
    <span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">23</span>),
  <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">byrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">state_names</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"H"</span>, <span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"D"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">transitions_soc</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">transitions_soc</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span>(<span class="no">state_names</span>)</pre></body></html></div>
</div>
<div id="relative-risk" class="section level2">
<h2 class="hasAnchor">
<a href="#relative-risk" class="anchor"></a><span class="header-section-number">2.2</span> Relative risk</h2>
<p>We estimate treatment effects in terms of the log relative risk since it is approximately normally distributed; that is, the relative risk follows a lognormal distribution. The mean is given by the log of the point estimate of the relative risk, or <span class="math inline">\(log(0.8)\)</span>.</p>
<p>Since academic studies often report 95% confidence intervals for a parameter, but not its standard error, we will assume that is the case. Specifically, let the lower bound be <span class="math inline">\(log(0.71)\)</span> and the upper bound be <span class="math inline">\(log(0.91)\)</span>. The standard error is then given by <span class="math inline">\((log(0.91) - log(0.71))/2z\)</span> where <span class="math inline">\(z = \Phi^{-1}(0.975)\approx 1.96\)</span>. See the Appendix for details.</p>
</div>
<div id="costs" class="section level2">
<h2 class="hasAnchor">
<a href="#costs" class="anchor"></a><span class="header-section-number">2.3</span> Costs</h2>
<div id="medical-costs" class="section level3">
<h3 class="hasAnchor">
<a href="#medical-costs" class="anchor"></a><span class="header-section-number">2.3.1</span> Medical costs</h3>
<p>Medical costs are of often assumed to follow a gamma distribution because it can be used to model right skewed distributions. The gamma distribution is defined in terms of a shape and scale (or rate) parameter. However, these parameters can be derived form the mean and standard deviation of a distribution using the <a href="https://hesim-dev.github.io/hesim/reference/mom_gamma.html">method of moments</a>. Mean costs follow those in the deterministic example (H = $2,000, S1 = $4,000, S2 = $2,000), D = <span class="math inline">\(0\)</span>). The standard deviation in each state is assumed to be equal to the mean.</p>
</div>
<div id="treatment-costs" class="section level3">
<h3 class="hasAnchor">
<a href="#treatment-costs" class="anchor"></a><span class="header-section-number">2.3.2</span> Treatment costs</h3>
<p>Treatment costs are fixed and equal to the costs in the deterministic example.</p>
</div>
</div>
<div id="utility" class="section level2">
<h2 class="hasAnchor">
<a href="#utility" class="anchor"></a><span class="header-section-number">2.4</span> Utility</h2>
<p>The utility associated with each state is assumed to follow a beta distribution, which is bounded between 0 and 1. The beta distribution is defined in terms of 2 shape parameters, but like the gamma distribution , these can be derived using the <a href="https://hesim-dev.github.io/hesim/reference/mom_beta.html">method of moments</a>. We assume that the mean (standard error) of utility is estimated to be <span class="math inline">\(1\)</span> <span class="math inline">\((0.0)\)</span>, <span class="math inline">\(0.75\)</span> <span class="math inline">\((0.03)\)</span>, <span class="math inline">\(0.5\)</span> <span class="math inline">\((0.05)\)</span>, and <span class="math inline">\(0\)</span> <span class="math inline">\((0.0)\)</span> in state H, S1, S2, and D, respectively.</p>
</div>
<div id="combining-the-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-the-parameters" class="anchor"></a><span class="header-section-number">2.5</span> Combining the parameters</h2>
<p>All model parameters (transition probabilities, relative risk, costs, and utility) can be stored in a list for use in the simulation.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">alpha_soc</span> <span class="kw">=</span> <span class="no">transitions_soc</span>,
  <span class="kw">lrr_mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">.8</span>),
  <span class="kw">lrr_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">.71</span>),
  <span class="kw">lrr_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">.9</span>),
  <span class="kw">c_medical</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">H</span> <span class="kw">=</span> <span class="fl">2000</span>, <span class="kw">S1</span> <span class="kw">=</span> <span class="fl">4000</span>, <span class="kw">S2</span> <span class="kw">=</span> <span class="fl">15000</span>, <span class="kw">D</span> <span class="kw">=</span> <span class="fl">0</span>),
  <span class="kw">c_soc</span> <span class="kw">=</span> <span class="fl">2000</span>,
  <span class="kw">c_new</span> <span class="kw">=</span> <span class="fl">12000</span>,
  <span class="kw">u_mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">H</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">S1</span> <span class="kw">=</span> <span class="fl">.75</span>, <span class="kw">S2</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">D</span> <span class="kw">=</span> <span class="fl">0</span>),
  <span class="kw">u_se</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">H</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">S1</span> <span class="kw">=</span> <span class="fl">0.03</span>, <span class="kw">S2</span> <span class="kw">=</span> <span class="fl">0.05</span>, <span class="kw">D</span> <span class="kw">=</span> <span class="fl">0.0</span>)
)</pre></body></html></div>
</div>
</div>
<div id="simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation" class="anchor"></a><span class="header-section-number">3</span> Simulation</h1>
<p>The simulation proceeds by (i) randomly sampling the parameters from the probability distributions specified above and (ii) running the Markov model for each draw of the parameters. The result is a draw from the probability distribution of each of the model outputs of interest (i.e, state probabilities, QALYs, and costs).</p>
<div id="sampling-the-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#sampling-the-parameters" class="anchor"></a><span class="header-section-number">3.1</span> Sampling the parameters</h2>
<p>While Base R can certainly be used to draw samples of the parameters, the functions <code><a href="https://rdrr.io/pkg/hesim/man/define_rng.html">hesim::define_rng()</a></code> and <code><a href="https://rdrr.io/pkg/hesim/man/define_rng.html">hesim::eval_rng()</a></code> simplify this process and make the code more readable. Any random number generation function can be used inside the <code><a href="https://rdrr.io/pkg/hesim/man/define_rng.html">define_rng()</a></code> block; the only rule is that returned parameter draws must be returned as a list. However, <code>hesim</code> comes with a number of helpful probability distribution functions (type <code><a href="https://rdrr.io/pkg/hesim/man/rng_distributions.html">?rng_distributions</a></code> for details) to make your life easier.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">rng_def</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/define_rng.html">define_rng</a></span>({
  <span class="no">lrr_se</span> <span class="kw">&lt;-</span> (<span class="no">lrr_upper</span> - <span class="no">lrr_lower</span>)/(<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="fl">.975</span>)) <span class="co"># Local object </span>
  <span class="co"># not returned</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>( <span class="co"># Parameters to return</span>
    <span class="kw">p_soc</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/rng_distributions.html">dirichlet_rng</a></span>(<span class="no">alpha_soc</span>),
    <span class="kw">rr_new</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/rng_distributions.html">lognormal_rng</a></span>(<span class="no">lrr_mean</span>, <span class="no">lrr_se</span>),
    <span class="kw">c_medical</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/rng_distributions.html">gamma_rng</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="no">c_medical</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="no">c_medical</span>),
    <span class="kw">c_soc</span> <span class="kw">=</span> <span class="no">c_soc</span>,
    <span class="kw">c_new</span> <span class="kw">=</span> <span class="no">c_new</span>,
    <span class="kw">u</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/rng_distributions.html">beta_rng</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="no">u_mean</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="no">u_se</span>)
  )
}, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">1000</span>)
<span class="no">params_rng</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/define_rng.html">eval_rng</a></span>(<span class="no">rng_def</span>, <span class="kw">params</span> <span class="kw">=</span> <span class="no">params</span>)
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">params_rng</span>, <span class="st">"n"</span>) <span class="kw">&lt;-</span> <span class="no">rng_def</span>$<span class="no">n</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">params_rng</span>)</pre></body></html></div>
<pre><code>## [1] "p_soc"     "rr_new"    "c_medical" "c_soc"     "c_new"     "u"</code></pre>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span>(<span class="no">params_rng</span>$<span class="no">p_soc</span>))</pre></body></html></div>
<pre><code>##            h_h      h_s1 h_s2          h_d      s1_h     s1_s1      s1_s2
## [1,] 0.8533180 0.1450427    0 0.0016393738 0.4971170 0.3895232 0.10755409
## [2,] 0.8552896 0.1425110    0 0.0021993395 0.4944048 0.4006269 0.09846083
## [3,] 0.8374851 0.1620546    0 0.0004602681 0.4909899 0.3852607 0.11681859
## [4,] 0.8336455 0.1645522    0 0.0018022845 0.4814801 0.4031365 0.11159125
## [5,] 0.8603914 0.1373614    0 0.0022471951 0.4856800 0.3869948 0.12181190
## [6,] 0.8299364 0.1689747    0 0.0010889720 0.4973090 0.3843372 0.11320830
##             s1_d s2_h s2_s1     s2_s2       s2_d d_h d_s1 d_s2 d_d
## [1,] 0.005805657    0     0 0.9809586 0.01904137   0    0    0   1
## [2,] 0.006507522    0     0 0.9798241 0.02017595   0    0    0   1
## [3,] 0.006930743    0     0 0.9852210 0.01477898   0    0    0   1
## [4,] 0.003792102    0     0 0.9758235 0.02417651   0    0    0   1
## [5,] 0.005513317    0     0 0.9684804 0.03151958   0    0    0   1
## [6,] 0.005145423    0     0 0.9833076 0.01669242   0    0    0   1</code></pre>
</div>
<div id="simulating-the-markov-model" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-the-markov-model" class="anchor"></a><span class="header-section-number">3.2</span> Simulating the Markov model</h2>
<p>Once samples of the parameters have been drawn, the Markov model can be simulated for each draw.</p>
<div id="input-data" class="section level3">
<h3 class="hasAnchor">
<a href="#input-data" class="anchor"></a><span class="header-section-number">3.2.1</span> Input data</h3>
<p>One way that a Markov simulation can be generalized is to store “input data” in an object such as a data frame. This <code>input data</code> might consist of different treatment strategies, patients and/or subgroups, or even information about the health states themselves. For instance, if we were simulating different subgroups we might store the age and sex associated with the subgroup which could, in turn, be used as covariates in a statistical model. In this simple example the data will just consist of the names of the two treatment strategies.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">strategy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"New"</span>, <span class="st">"SOC"</span>)
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">data</span>)</pre></body></html></div>
<pre><code>##   strategy
## 1      New
## 2      SOC</code></pre>
</div>
<div id="running-the-simulation" class="section level3">
<h3 class="hasAnchor">
<a href="#running-the-simulation" class="anchor"></a><span class="header-section-number">3.2.2</span> Running the simulation</h3>
<p>It is a good idea to modularize your R code into functions. This can make your code more readable, maintainable, and reusable. We will work toward a <code>sim_model()</code> function that runs the entire simulation. It will be comprised of three smaller functions: <code>sim_stateprobs()</code>, <code>compute_qalys()</code>, and <code>compute_costs()</code>.</p>
<p>The <code>sim_stateprobs()</code> function will simulate health state probabilities for each model cycle (i.e., the Markov trace) for a given treatment strategy and parameter sample. It takes the arguments:</p>
<ul>
<li>
<code>p0</code>: the transition probability matrix for SOC,</li>
<li>
<code>rr</code>: the relative risk)</li>
<li>
<code>strategy</code>: the name of the treatment strategy as defined in <code>data</code> above.</li>
<li>
<code>n_cycles</code>: The number of cycles to simulate the model for.</li>
</ul>
<p>To make the code more readable, we will use the function <code><a href="https://rdrr.io/pkg/hesim/man/tpmatrix.html">hesim::tpmatrix()</a></code> which makes it easy to define a transition probability matrix. The symbol <code>C</code> denotes that a given element is the complement of all other elements in that row, ensuring that the probabilities sum to 1.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">sim_stateprobs</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">p0</span>, <span class="no">rr</span>, <span class="no">strategy</span>, <span class="no">n_cycles</span>){
  <span class="no">rr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span>(<span class="no">strategy</span> <span class="kw">==</span> <span class="st">"New"</span>, <span class="no">rr</span>, <span class="fl">1</span>)
  <span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/tpmatrix.html">tpmatrix</a></span>(
    <span class="no">C</span>,       <span class="no">p0</span>$<span class="no">h_s1</span> * <span class="no">rr</span>,  <span class="no">p0</span>$<span class="no">h_s2</span> * <span class="no">rr</span>,  <span class="no">p0</span>$<span class="no">h_d</span> * <span class="no">rr</span>,
    <span class="no">p0</span>$<span class="no">s1_h</span>, <span class="no">C</span>,             <span class="no">p0</span>$<span class="no">s1_s2</span> * <span class="no">rr</span>, <span class="no">p0</span>$<span class="no">s1_d</span> * <span class="no">rr</span>,
    <span class="no">p0</span>$<span class="no">s2_h</span>, <span class="no">p0</span>$<span class="no">s2_s1</span>,      <span class="no">C</span>,             <span class="no">p0</span>$<span class="no">s2_d</span> * <span class="no">rr</span>,
    <span class="fl">0</span>,       <span class="fl">0</span>,             <span class="fl">0</span>,             <span class="fl">1</span>
  )
  <span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_markov_chain.html">sim_markov_chain</a></span>(<span class="kw">x0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>),
                        <span class="kw">p</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span>(<span class="no">p</span>), <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">byrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
                        <span class="kw">n_cycles</span> <span class="kw">=</span> <span class="no">n_cycles</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">x</span>)
}</pre></body></html></div>
<p>To compute (discounted) QALYs for a given Markov trace, we will use a very simple function that is identical to the <code>compute_qalys</code> function used in the deterministic example.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">compute_qalys</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">utility</span>, <span class="no">dr</span> <span class="kw">=</span> <span class="fl">.03</span>){
  <span class="no">n_cycles</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">x</span>) - <span class="fl">1</span>
  <span class="fu"><a href="../reference/pv.html">pv</a></span>(<span class="no">x</span> <span class="kw">%*%</span> <span class="no">utility</span>, <span class="no">dr</span>, <span class="fl">0</span>:<span class="no">n_cycles</span>)
}</pre></body></html></div>
<p>Similarly, our cost function is nearly identical to the <code>compute_costs()</code> function from the deterministic example.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">compute_costs</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">costs_medical</span>, <span class="no">costs_treat</span>, <span class="no">dr</span> <span class="kw">=</span> <span class="fl">.03</span>){
  <span class="no">n_cycles</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">x</span>) - <span class="fl">1</span>
  <span class="no">costs_treat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">costs_treat</span>, <span class="fl">3</span>), <span class="fl">0</span>)
  <span class="no">costs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(
    <span class="fu"><a href="../reference/pv.html">pv</a></span>(<span class="no">x</span> <span class="kw">%*%</span> <span class="no">costs_medical</span>, <span class="no">dr</span>, <span class="fl">0</span>:<span class="no">n_cycles</span>),
    <span class="fu"><a href="../reference/pv.html">pv</a></span>(<span class="no">x</span> <span class="kw">%*%</span> <span class="no">costs_treat</span>, <span class="no">dr</span>, <span class="fl">0</span>:<span class="no">n_cycles</span>)
  )
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">costs</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"dcost_med"</span>, <span class="st">"dcost_treat"</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">costs</span>)
}</pre></body></html></div>
<p>Now that we have created the building blocks for the simulation, we can create our main function to simulate the entire model. 3% discount rates are set by default for costs and QALYs. Most of the function arguments should be self explanatory, but two are worth explaining:</p>
<ul>
<li>
<code>params_rng</code>: The output of <code><a href="https://rdrr.io/pkg/hesim/man/define_rng.html">eval_rng()</a></code> above.</li>
<li>
<code>data</code>: The data object defined above</li>
</ul>
<p>The first part of the function creates an array to store the output. The array is a series of matrices each with <code>n_cycles</code> rows and columns for each output (i.e., state probabilities for the four health states, QALYs, treatment costs, and medical costs). There is one matrix for each parameter sample for the PSA and treatment strategy.</p>
<p>The second part of the function simulates state probabilities (with <code>sim_stateprobs()</code>), QALYs (with <code>compute_qalys()</code>), and costs (with <code>compute_costs()</code>) for each parameter sample and treatment strategy. The number of parameter samples and the names of the treatment strategies are saved as attributes (i.e., metadata) to the array which will be used below to convert the array to a data frame.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">sim_model</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">params_rng</span>, <span class="no">data</span>, <span class="no">n_cycles</span> <span class="kw">=</span> <span class="fl">85</span>,
                      <span class="no">dr_qalys</span> <span class="kw">=</span> <span class="fl">.03</span>, <span class="no">dr_costs</span> <span class="kw">=</span> <span class="fl">.03</span>){
  <span class="co"># Initialize array of matrices</span>
  <span class="no">n_samples</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">params_rng</span>, <span class="st">"n"</span>)
  <span class="no">n_strategies</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">data</span>)
  <span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="fl">NA</span>, <span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">n_cycles</span> + <span class="fl">1</span>, <span class="fl">7</span>, <span class="no">n_samples</span> * <span class="no">n_strategies</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">out</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">NULL</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"H"</span>, <span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"D"</span>,
                          <span class="st">"dqalys"</span>, <span class="st">"dcosts_med"</span>, <span class="st">"dcosts_treat"</span>),
                        <span class="kw">NULL</span>)

  <span class="co"># Run the simulation</span>
  <span class="no">i</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
  <span class="kw">for</span> (<span class="no">s</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n_samples</span>){ <span class="co"># Start PSA loop</span>
    <span class="kw">for</span> (<span class="no">k</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n_strategies</span>) { <span class="co"># Start treatment strategy loop</span>
      <span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu">sim_stateprobs</span>(<span class="kw">p0</span> <span class="kw">=</span> <span class="no">params_rng</span>$<span class="no">p_soc</span>[<span class="no">s</span>, ],
                          <span class="kw">rr</span> <span class="kw">=</span> <span class="no">params_rng</span>$<span class="no">rr_new</span>[<span class="no">s</span>],
                          <span class="kw">strategy</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">strategy</span>[<span class="no">k</span>],
                          <span class="kw">n_cycles</span> <span class="kw">=</span> <span class="no">n_cycles</span>)
      <span class="no">dqalys</span> <span class="kw">&lt;-</span> <span class="fu">compute_qalys</span>(<span class="no">x</span>, <span class="kw">utility</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">params_rng</span>$<span class="no">u</span>[<span class="no">s</span>]),
                              <span class="kw">dr</span> <span class="kw">=</span> <span class="no">dr_qalys</span>)
      <span class="no">dcosts</span> <span class="kw">&lt;-</span> <span class="fu">compute_costs</span>(<span class="no">x</span>,
                              <span class="kw">costs_medical</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">params_rng</span>$<span class="no">c_medical</span>[<span class="no">s</span>]),
                              <span class="kw">costs_treat</span> <span class="kw">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span>(<span class="no">data</span>$<span class="no">strategy</span>[<span class="no">k</span>] <span class="kw">==</span> <span class="st">"SOC"</span>,
                                                   <span class="no">params_rng</span>$<span class="no">c_soc</span>,
                                                   <span class="no">params_rng</span>$<span class="no">c_new</span>),
                              <span class="kw">dr</span> <span class="kw">=</span> <span class="no">dr_costs</span>)
      <span class="no">out</span>[, , <span class="no">i</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">x</span>, <span class="no">dqalys</span>, <span class="no">dcosts</span>)
      <span class="no">i</span> <span class="kw">&lt;-</span> <span class="no">i</span> + <span class="fl">1</span>
    } <span class="co"># End treatment strategy loop</span>
  } <span class="co"># End PSA loop</span>

  <span class="co"># Store metadata and return</span>
  <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">out</span>, <span class="st">"n_samples"</span>) <span class="kw">&lt;-</span> <span class="no">n_samples</span>
  <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">out</span>, <span class="st">"strategies"</span>) <span class="kw">&lt;-</span> <span class="no">data</span>$<span class="no">strategy</span>
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">out</span>)
}</pre></body></html></div>
<p>Now that we’ve written the function, lets simulate the model with argument defaults (85 model cycles and 3% discount rates). Recall that each array is a matrix.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu">sim_model</span>(<span class="no">params_rng</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">data</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim_out</span>[, , <span class="fl">1</span>])</pre></body></html></div>
<pre><code>##              H        S1          S2            D    dqalys dcosts_med
## [1,] 1.0000000 0.0000000 0.000000000 0.0000000000 1.0000000   391.6504
## [2,] 0.8928653 0.1061637 0.000000000 0.0009710098 0.9442218   383.5689
## [3,] 0.8494038 0.1392268 0.009226654 0.0021427131 0.9032621  1092.4616
## [4,] 0.8268541 0.1484520 0.021134635 0.0035592950 0.8678124  1961.8321
## [5,] 0.8112558 0.1499194 0.033596348 0.0052284873 0.8348972  2819.9926
## [6,] 0.7980500 0.1488777 0.045926034 0.0071463062 0.8035486  3616.9170
##      dcosts_treat
## [1,]     12000.00
## [2,]     11639.17
## [3,]     11286.91
## [4,]     10942.61
## [5,]     10606.10
## [6,]     10277.33</code></pre>
<p>Although arrays are computationally efficient objects for storing data, they aren’t often the most useful for summarizing data. We will write to short functions to convert a 3D array to a <code>data.table</code> (with ID columns for the parameter sample and treatment strategy) so that we can summarize outcomes for each parameter sample and treatment strategy very quickly. (Note that other packages such as <code>dplyr</code> could also be used but we prefer <code>data.table</code> for simulations because of its speed).</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co"># rbind an array of matrices into a single matrix</span>
<span class="no">rbind_array</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>){
  <span class="no">n_rows</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">x</span>)[<span class="fl">3</span>] * <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">x</span>)[<span class="fl">1</span>]
  <span class="no">x_mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="no">x</span>, <span class="kw">perm</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">3</span>))),
                  <span class="kw">nrow</span> <span class="kw">=</span> <span class="no">n_rows</span>, <span class="kw">byrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">x_mat</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">x</span>)<span class="kw">[[</span><span class="fl">2</span>]]
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">x_mat</span>)
}

<span class="co"># Convert the array into a long dataframe with ID columns</span>
<span class="no">array_to_dt</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>){
  <span class="no">id_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="kw">cycle</span> <span class="kw">=</span> <span class="fl">0</span>:(<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">x</span>)[<span class="fl">1</span>] - <span class="fl">1</span>),
                       <span class="kw">strategy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">x</span>, <span class="st">"strategies"</span>),
                       <span class="kw">sample</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">x</span>, <span class="st">"n_samples"</span>))
  <span class="no">x_mat</span> <span class="kw">&lt;-</span> <span class="fu">rbind_array</span>(<span class="no">x</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">id_df</span>, <span class="no">x_mat</span>)))
}

<span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu">array_to_dt</span>(<span class="no">sim_out</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim_out</span>)</pre></body></html></div>
<pre><code>##    cycle strategy sample         H        S1          S2            D    dqalys
## 1:     0      New      1 1.0000000 0.0000000 0.000000000 0.0000000000 1.0000000
## 2:     1      New      1 0.8928653 0.1061637 0.000000000 0.0009710098 0.9442218
## 3:     2      New      1 0.8494038 0.1392268 0.009226654 0.0021427131 0.9032621
## 4:     3      New      1 0.8268541 0.1484520 0.021134635 0.0035592950 0.8678124
## 5:     4      New      1 0.8112558 0.1499194 0.033596348 0.0052284873 0.8348972
## 6:     5      New      1 0.7980500 0.1488777 0.045926034 0.0071463062 0.8035486
##    dcosts_med dcosts_treat
## 1:   391.6504     12000.00
## 2:   383.5689     11639.17
## 3:  1092.4616     11286.91
## 4:  1961.8321     10942.61
## 5:  2819.9926     10606.10
## 6:  3616.9170     10277.33</code></pre>
</div>
</div>
</div>
<div id="cost-effectiveness-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#cost-effectiveness-analysis" class="anchor"></a><span class="header-section-number">4</span> Cost-effectiveness analysis</h1>
<p>A cost-effectiveness analysis can be performed using the simulation output. The PSA is typically used to represent decision uncertainty using the distribution of (discounted) QALYs and (discounted) total costs. As such, will compute mean discounted QALYs and discounted costs by parameter sample and treatment strategy.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">ce_out</span> <span class="kw">&lt;-</span> <span class="no">sim_out</span>[, <span class="fu">.</span>(<span class="kw">dqalys</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">dqalys</span>),
                      <span class="kw">dcosts</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">dcosts_med</span>) + <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">dcosts_treat</span>)),
                  <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sample"</span>, <span class="st">"strategy"</span>)]
<span class="no">ce_out</span></pre></body></html></div>
<pre><code>##       sample strategy   dqalys    dcosts
##    1:      1      New 24.54358 792937.36
##    2:      1      SOC 22.58874 588798.22
##    3:      2      New 25.58334 373840.46
##    4:      2      SOC 23.81190  80466.13
##    5:      3      New 24.29041 402926.01
##   ---                                   
## 1996:    998      SOC 23.54556 322360.83
## 1997:    999      New 23.84384 407143.21
## 1998:    999      SOC 21.50050 127798.21
## 1999:   1000      New 24.35950 410993.90
## 2000:   1000      SOC 22.54831 145359.67</code></pre>
<p>In the two treatment strategy case its simpler to “widen” the data so that we can easily compute incremental QALYs and costs.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">ce_out_wider</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/dcast.data.table.html">dcast</a></span>(<span class="no">ce_out</span>, <span class="no">sample</span> ~ <span class="no">strategy</span>,
                      <span class="kw">value.var</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"dqalys"</span>, <span class="st">"dcosts"</span>))
<span class="no">ce_out_wider</span></pre></body></html></div>
<pre><code>##       sample dqalys_New dqalys_SOC dcosts_New dcosts_SOC
##    1:      1   24.54358   22.58874   792937.4  588798.22
##    2:      2   25.58334   23.81190   373840.5   80466.13
##    3:      3   24.29041   22.65966   402926.0  104673.24
##    4:      4   23.12511   21.33337   389220.4  123157.10
##    5:      5   24.93308   23.08824   761615.6  549790.21
##   ---                                                   
##  996:    996   22.85343   21.27057   398659.6  125772.00
##  997:    997   23.75428   22.27465   481371.6  212820.14
##  998:    998   26.22319   23.54556   562593.8  322360.83
##  999:    999   23.84384   21.50050   407143.2  127798.21
## 1000:   1000   24.35950   22.54831   410993.9  145359.67</code></pre>
<p>The ICER is computed by taking means across all parameter samples. (Note that in a subsequent tutorial will show how to represent decision uncertainty using the PSA output).</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">ce_out_wider</span>[, <span class="fu">.</span>(<span class="kw">icer</span> <span class="kw">=</span> (<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">dcosts_New</span> - <span class="no">dcosts_SOC</span>))/
                   <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">dqalys_New</span> - <span class="no">dqalys_SOC</span>))]</pre></body></html></div>
<pre><code>##        icer
## 1: 130355.9</code></pre>
</div>
<div id="appendix" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix" class="anchor"></a><span class="header-section-number">5</span> Appendix</h1>
<div id="dirichlet-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#dirichlet-distribution" class="anchor"></a><span class="header-section-number">5.1</span> Dirichlet distribution</h2>
<p>The multinomial distribution is a discrete probability distribution for the number of successes for each of k mutually exclusive categories in n trials. The probabilities of the categories are given by <span class="math inline">\(\pi_1,\ldots, \pi_k\)</span> with <span class="math inline">\(\sum_{j=1}^k \pi_j=1\)</span> and each <span class="math inline">\(\pi_j\)</span> defined on <span class="math inline">\([0,1]\)</span>. The Dirichlet distribution is parameterized by the concentration parameters <span class="math inline">\(\alpha_1,\ldots, \alpha_k\)</span> with <span class="math inline">\(\alpha_j &gt; 0\)</span>. Letting <span class="math inline">\(x_1,\ldots, x_k\)</span> denote the number of successes in each category, the prior distribution and likelihood are,</p>
<p><span class="math display">\[
\begin{aligned}
p(\pi_1,\ldots,\pi_k |\alpha_1,\ldots, \alpha_k) = \text{Dirichlet}(\alpha_1,\ldots,\alpha_k) \\
p(x_1,\ldots,x_k | \pi_1,\ldots,\pi_k) = \text{Multin}(n, \pi_1,\ldots,\pi_k).
\end{aligned}
\]</span></p>
</div>
<div id="confidence-intervals-and-standard-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#confidence-intervals-and-standard-errors" class="anchor"></a><span class="header-section-number">5.2</span> Confidence intervals and standard errors</h2>
<p>Let <span class="math inline">\(\theta\)</span> be a normally distributed random variable, <span class="math inline">\(\sigma\)</span> be the standard deviation of <span class="math inline">\(\theta\)</span>, and <span class="math inline">\(z = \Phi^{-1}(1 - \alpha/2)\)</span> for a given confidence level <span class="math inline">\(\alpha\)</span>. A confidence interval for <span class="math inline">\(\theta\)</span> is then given by <span class="math inline">\((\theta - z\sigma, \theta + z\sigma)\)</span> with width given by <span class="math inline">\(2z\sigma\)</span>. If lower and upper limits are given by <span class="math inline">\(\theta_L\)</span> and <span class="math inline">\(\theta_U\)</span>, <span class="math inline">\(\sigma\)</span> can be solved with</p>
<p><span class="math display">\[
\sigma = \frac{\theta_U - \theta_L}{2z}.
\]</span></p>
<p>A 95% confidence interval is evaluated with <span class="math inline">\(z = \Phi^{-1}(.975)\)</span>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
