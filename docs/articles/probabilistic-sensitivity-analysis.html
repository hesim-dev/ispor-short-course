<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Incorporating Probabilistic Sensitivity Analysis â€¢ learnCEA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Incorporating Probabilistic Sensitivity Analysis">
<meta property="og:description" content="learnCEA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">learnCEA</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simple-markov-cohort-model.html">Simple Markov Cohort Model</a>
    </li>
    <li>
      <a href="../articles/probabilistic-sensitivity-analysis.html">Incorporating Probabilistic Sensitivity Analysis</a>
    </li>
    <li>
      <a href="../articles/simple-markov-cohort-model-hesim.html">Simple Markov Cohort Model (hesim)</a>
    </li>
    <li>
      <a href="../articles/partitioned-survival-model.html">Partitioned Survival Model</a>
    </li>
    <li>
      <a href="../articles/individual-patient-simulation.html">Individual Patient Simulation</a>
    </li>
    <li>
      <a href="../articles/decision-analysis.html">Decision Analysis</a>
    </li>
    <li class="divider">
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hesim-dev/ispor-short-course/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Incorporating Probabilistic Sensitivity Analysis</h1>
            
            <h4 class="date">2020-08-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hesim-dev/ispor-short-course/blob/master/vignettes/probabilistic-sensitivity-analysis.Rmd"><code>vignettes/probabilistic-sensitivity-analysis.Rmd</code></a></small>
      <div class="hidden name"><code>probabilistic-sensitivity-analysis.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a><span class="header-section-number">1</span> Overview</h1>
<p>Probabilistic sensitivity analysis (PSA) is used to quantify the impact of parameter uncertainty on the uncertainty of model outputs. PSA is typically performed via a simulate approach whereby the model parameters are randomly sampled from suitable probability distributions and the entire model is simulated for each random draw of the parameters.</p>
<p>In this example, we extend the deterministic <a href="simple-markov-cohort-model.html">simple Markov cohort model</a> to incorporate PSA. We will continue to rely primarily on Base <code>R</code> but will use the <code>hesim</code> package to help make the code more readable.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"learnCEA"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"hesim"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"magrittr"</span>)</pre></body></html></div>
</div>
<div id="model-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#model-parameters" class="anchor"></a><span class="header-section-number">2</span> Model parameters</h1>
<div id="transition-probabilities-for-soc" class="section level2">
<h2 class="hasAnchor">
<a href="#transition-probabilities-for-soc" class="anchor"></a><span class="header-section-number">2.1</span> Transition probabilities for SOC</h2>
<p>The probability distribution used for transition probabilities will depend on the underlying data. In this case, we assume that summary level data is available on transitions from the Healthy state (n = 900), Sick state (n = 900), and Sicker state (n = 800). The transitions from each state to the othe 4 states can be modeled using a Dirichlet distribution (see Appendix).</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">transitions_soc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">848</span>, <span class="fl">150</span>, <span class="fl">0</span>,   <span class="fl">2</span>,
    <span class="fl">450</span>, <span class="fl">355</span>, <span class="fl">95</span>,  <span class="fl">5</span>,
    <span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">784</span>, <span class="fl">16</span>,
    <span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">0</span>,   <span class="fl">23</span>),
  <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">byrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">state_names</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"H"</span>, <span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"D"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">transitions_soc</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">transitions_soc</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span>(<span class="no">state_names</span>)</pre></body></html></div>
</div>
<div id="relative-risk" class="section level2">
<h2 class="hasAnchor">
<a href="#relative-risk" class="anchor"></a><span class="header-section-number">2.2</span> Relative risk</h2>
<p>We estimate treatment effects in terms of the log relative risk since it is approximately normally distributed; that is, the relative risk follows a lognormal distribution. The mean is given by the log of the point estimate of the relatie risk, or <span class="math inline">\(log(0.8)\)</span>.</p>
<p>Since academic studies often report 95% confidence intervals for a parameter, but not its standard error, we will assume that is the case. Specifically, let the lower bound be <span class="math inline">\(log(0.71)\)</span> and the upper bound be <span class="math inline">\(log(0.91)\)</span>. The standard error is then given by <span class="math inline">\((log(0.91) - log(0.71))/(2z)\)</span> where <span class="math inline">\(z = \Phi^{-1}(0.975)\approx 1.96\)</span>. See the Appendix for details.</p>
</div>
<div id="costs" class="section level2">
<h2 class="hasAnchor">
<a href="#costs" class="anchor"></a><span class="header-section-number">2.3</span> Costs</h2>
<div id="medical-costs" class="section level3">
<h3 class="hasAnchor">
<a href="#medical-costs" class="anchor"></a><span class="header-section-number">2.3.1</span> Medical costs</h3>
<p>Medical costs are of often assumed to follow a gamma distribution because it can be used to model right skewed distributions. The gamma distribtution is defined in terms of a shape and scale (or rate) parameter. However, these parameters can be derived form the mean and standard deviation of a distribution using the <a href="https://hesim-dev.github.io/hesim/reference/mom_gamma.html">method of moments</a>. Mean costs follow those in the deterministic example (H = $2,000, S1 = $4,000, and S2 = $2,000). The standard deviation in each state is assume to be equal to the mean.</p>
</div>
<div id="treatment-costs" class="section level3">
<h3 class="hasAnchor">
<a href="#treatment-costs" class="anchor"></a><span class="header-section-number">2.3.2</span> Treatment costs</h3>
<p>Treatment costs are fixed and equal to the costs in the deterministic example.</p>
</div>
</div>
<div id="utility" class="section level2">
<h2 class="hasAnchor">
<a href="#utility" class="anchor"></a><span class="header-section-number">2.4</span> Utility</h2>
<p>The utility associated with each state is assumed to follow a beta distribution, which is bounded between 0 and 1. The beta distribution is defined in terms of 2 shape parameters, but like the gamma distribution , these can be derived using the <a href="https://hesim-dev.github.io/hesim/reference/mom_beta.html">method of moments</a>. We assume that the mean (standard error) of utility is estimated to be <span class="math inline">\(1 (0.0)\)</span>, <span class="math inline">\(0.75 (0,03)\)</span>, <span class="math inline">\(0.5 (0.05)\)</span>, and <span class="math inline">\(0 (0.0)\)</span> in state H, S1, S2, and D, respectively.</p>
</div>
<div id="combining-the-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-the-parameters" class="anchor"></a><span class="header-section-number">2.5</span> Combining the parameters</h2>
<p>All model parameters (transition probabilities, relative risk, costs, and utility) can be stored in a list for use in the simulation.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">alpha_soc</span> <span class="kw">=</span> <span class="no">transitions_soc</span>,
  <span class="kw">lrr_mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">.8</span>),
  <span class="kw">lrr_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">.71</span>),
  <span class="kw">lrr_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">.9</span>),
  <span class="kw">c_medical</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">H</span> <span class="kw">=</span> <span class="fl">2000</span>, <span class="kw">S1</span> <span class="kw">=</span> <span class="fl">4000</span>, <span class="kw">S2</span> <span class="kw">=</span> <span class="fl">15000</span>, <span class="kw">D</span> <span class="kw">=</span> <span class="fl">0</span>),
  <span class="kw">c_soc</span> <span class="kw">=</span> <span class="fl">2000</span>,
  <span class="kw">c_new</span> <span class="kw">=</span> <span class="fl">12000</span>,
  <span class="kw">u</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">H</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">S1</span> <span class="kw">=</span> <span class="fl">.075</span>, <span class="kw">S2</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">D</span> <span class="kw">=</span> <span class="fl">0</span>)
)</pre></body></html></div>
</div>
</div>
<div id="simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation" class="anchor"></a><span class="header-section-number">3</span> Simulation</h1>
<div id="sampling-the-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#sampling-the-parameters" class="anchor"></a><span class="header-section-number">3.1</span> Sampling the parameters</h2>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">rng_def</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/define_rng.html">define_rng</a></span>({
  <span class="no">lrr_se</span> <span class="kw">&lt;-</span> (<span class="no">lrr_upper</span> - <span class="no">lrr_lower</span>)/(<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="fl">.975</span>)) <span class="co"># Local object </span>
                                                      <span class="co"># not returned</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>( <span class="co"># Parameters to return</span>
    <span class="kw">p_soc</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/rng_distributions.html">dirichlet_rng</a></span>(<span class="no">alpha_soc</span>),
    <span class="kw">rr_new</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/rng_distributions.html">lognormal_rng</a></span>(<span class="no">lrr_mean</span>, <span class="no">lrr_se</span>),
    <span class="kw">c_medical</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/rng_distributions.html">gamma_rng</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="no">c_medical</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="no">c_medical</span>),
    <span class="kw">c_soc</span> <span class="kw">=</span> <span class="no">c_soc</span>,
    <span class="kw">c_new</span> <span class="kw">=</span> <span class="no">c_new</span>,
    <span class="kw">u</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/rng_distributions.html">fixed</a></span>(<span class="no">u</span>)
  )
}, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">1000</span>)
<span class="no">params_rng</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/define_rng.html">eval_rng</a></span>(<span class="no">rng_def</span>, <span class="kw">params</span> <span class="kw">=</span> <span class="no">params</span>)
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">params_rng</span>, <span class="st">"n"</span>) <span class="kw">&lt;-</span> <span class="no">rng_def</span>$<span class="no">n</span></pre></body></html></div>
</div>
<div id="simulating-the-markov-model" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-the-markov-model" class="anchor"></a><span class="header-section-number">3.2</span> Simulating the Markov model</h2>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">strategy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"New"</span>, <span class="st">"SOC"</span>)
)</pre></body></html></div>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">sim_stateprobs</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">p0</span>, <span class="no">rr</span>, <span class="no">strategy</span>, <span class="no">n_cycles</span>){
  <span class="no">rr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">strategy</span> <span class="kw">==</span> <span class="st">"New"</span>, <span class="no">rr</span>, <span class="fl">1</span>)
  <span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hesim/man/tpmatrix.html">tpmatrix</a></span>(
    <span class="no">C</span>,       <span class="no">p0</span>$<span class="no">h_s1</span> * <span class="no">rr</span>,  <span class="no">p0</span>$<span class="no">h_s2</span> * <span class="no">rr</span>,  <span class="no">p0</span>$<span class="no">h_d</span> * <span class="no">rr</span>,
    <span class="no">p0</span>$<span class="no">s1_h</span>, <span class="no">C</span>,             <span class="no">p0</span>$<span class="no">s1_s2</span> * <span class="no">rr</span>, <span class="no">p0</span>$<span class="no">s1_d</span> * <span class="no">rr</span>,
    <span class="no">p0</span>$<span class="no">s2_h</span>, <span class="no">p0</span>$<span class="no">s2_s1</span>,      <span class="no">C</span>,             <span class="no">p0</span>$<span class="no">s2_d</span> * <span class="no">rr</span>,
    <span class="fl">0</span>,       <span class="fl">0</span>,             <span class="fl">0</span>,             <span class="fl">1</span>
  )
  <span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_markov_chain.html">sim_markov_chain</a></span>(<span class="kw">x0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>),
                        <span class="kw">p</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">p</span>), <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">byrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
                        <span class="kw">n_cycles</span> <span class="kw">=</span> <span class="no">n_cycles</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">x</span>)
}</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># QALYs</span>
<span class="no">compute_qalys</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">utility</span>, <span class="no">dr</span> <span class="kw">=</span> <span class="fl">.03</span>){
  <span class="no">n_cycles</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">x</span>) - <span class="fl">1</span>
  <span class="fu"><a href="../reference/pv.html">pv</a></span>(<span class="no">x</span> <span class="kw">%*%</span> <span class="no">utility</span>, <span class="no">dr</span>, <span class="fl">0</span>:<span class="no">n_cycles</span>)
}

<span class="co"># Costs</span>
<span class="no">compute_costs</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">costs_medical</span>, <span class="no">costs_treat</span>, <span class="no">dr</span> <span class="kw">=</span> <span class="fl">.03</span>){
  <span class="no">n_cycles</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">x</span>) - <span class="fl">1</span>
  <span class="no">costs_treat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">costs_treat</span>, <span class="fl">3</span>), <span class="fl">0</span>)
  <span class="no">costs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(
    <span class="fu"><a href="../reference/pv.html">pv</a></span>(<span class="no">x</span> <span class="kw">%*%</span> <span class="no">costs_medical</span>, <span class="no">dr</span>, <span class="fl">0</span>:<span class="no">n_cycles</span>),
    <span class="fu"><a href="../reference/pv.html">pv</a></span>(<span class="no">x</span> <span class="kw">%*%</span> <span class="no">costs_treat</span>, <span class="no">dr</span>, <span class="fl">0</span>:<span class="no">n_cycles</span>)
  )
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">costs</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"dcost_med"</span>, <span class="st">"dcost_treat"</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">costs</span>)
}</pre></body></html></div>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">sim_model</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">params_rng</span>, <span class="no">data</span>, <span class="no">n_cycles</span> <span class="kw">=</span> <span class="fl">85</span>,
                      <span class="no">dr_qalys</span> <span class="kw">=</span> <span class="fl">.03</span>, <span class="no">dr_costs</span> <span class="kw">=</span> <span class="fl">.03</span>){
  <span class="co"># Initialize array of matrices</span>
  <span class="no">n_samples</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">params_rng</span>, <span class="st">"n"</span>)
  <span class="no">n_strategies</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">data</span>)
  <span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="fl">NA</span>, <span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">n_cycles</span> + <span class="fl">1</span>, <span class="fl">7</span>, <span class="no">n_samples</span> * <span class="no">n_strategies</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">out</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">NULL</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"H"</span>, <span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"D"</span>,
                          <span class="st">"dqalys"</span>, <span class="st">"dcosts_med"</span>, <span class="st">"dcosts_treat"</span>),
                        <span class="kw">NULL</span>)

  <span class="co"># Run the simulation</span>
  <span class="no">i</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
  <span class="kw">for</span> (<span class="no">s</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n_samples</span>){ <span class="co"># Start PSA loop</span>
    <span class="kw">for</span> (<span class="no">k</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n_strategies</span>) { <span class="co"># Start treatment strategy loop</span>
      <span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu">sim_stateprobs</span>(<span class="kw">p0</span> <span class="kw">=</span> <span class="no">params_rng</span>$<span class="no">p_soc</span>[<span class="no">s</span>, ],
                          <span class="kw">rr</span> <span class="kw">=</span> <span class="no">params_rng</span>$<span class="no">rr_new</span>[<span class="no">s</span>],
                          <span class="kw">strategy</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">strategy</span>[<span class="no">k</span>],
                          <span class="kw">n_cycles</span> <span class="kw">=</span> <span class="no">n_cycles</span>)
     <span class="no">dqalys</span> <span class="kw">&lt;-</span> <span class="fu">compute_qalys</span>(<span class="no">x</span>, <span class="kw">utility</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">params_rng</span>$<span class="no">u</span>[<span class="no">s</span>]),
                             <span class="kw">dr</span> <span class="kw">=</span> <span class="no">dr_qalys</span>)
     <span class="no">dcosts</span> <span class="kw">&lt;-</span> <span class="fu">compute_costs</span>(<span class="no">x</span>,
                             <span class="kw">costs_medical</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">params_rng</span>$<span class="no">c_medical</span>[<span class="no">s</span>]),
                             <span class="kw">costs_treat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">data</span>$<span class="no">strategy</span>[<span class="no">k</span>] <span class="kw">==</span> <span class="st">"SOC"</span>,
                                                  <span class="no">params_rng</span>$<span class="no">c_soc</span>,
                                                  <span class="no">params_rng</span>$<span class="no">c_new</span>),
                             <span class="kw">dr</span> <span class="kw">=</span> <span class="no">dr_costs</span>)
      <span class="no">out</span>[, , <span class="no">i</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">x</span>, <span class="no">dqalys</span>, <span class="no">dcosts</span>)
      <span class="no">i</span> <span class="kw">&lt;-</span> <span class="no">i</span> + <span class="fl">1</span>
    } <span class="co"># End treatment strategy loop</span>
  } <span class="co"># End PSA loop</span>
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">out</span>)
}</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu">sim_model</span>(<span class="no">params_rng</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">data</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim_out</span>[, , <span class="fl">1</span>])</pre></body></html></div>
<pre><code>##              H        S1          S2           D    dqalys dcosts_med
## [1,] 1.0000000 0.0000000 0.000000000 0.000000000 1.0000000   1970.317
## [2,] 0.8882508 0.1098658 0.000000000 0.001883429 0.8703793   1925.768
## [3,] 0.8415376 0.1467803 0.007726888 0.003955152 0.8072482   2027.778
## [4,] 0.8177006 0.1581765 0.017979318 0.006143548 0.7673952   2168.090
## [5,] 0.8019781 0.1606603 0.028939477 0.008422179 0.7361092   2310.649
## [6,] 0.7892005 0.1600450 0.039974076 0.010780454 0.7083665   2443.897
##      dcosts_treat
## [1,]     12000.00
## [2,]     11628.54
## [3,]     11266.41
## [4,]     10914.23
## [5,]     10572.05
## [6,]     10239.71</code></pre>
</div>
</div>
<div id="appendix" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix" class="anchor"></a><span class="header-section-number">4</span> Appendix</h1>
<div id="dirichlet-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#dirichlet-distribution" class="anchor"></a><span class="header-section-number">4.1</span> Dirichlet distribution</h2>
<p>The multinomial distribution is a discrete probability distribution for the number of successes for each of k mutually exclusive categories in n trials. The probabilities of the categories are given by <span class="math inline">\(\pi_1,\ldots, \pi_k\)</span> with <span class="math inline">\(\sum_{j=1}^k \pi_j=1\)</span> and each <span class="math inline">\(\pi_j\)</span> defined on <span class="math inline">\([0,1]\)</span>. The Dirichlet distribution is parameterized by the concentration parameters <span class="math inline">\(\alpha_1,\ldots, \alpha_k\)</span> with <span class="math inline">\(\alpha_j &gt; 0\)</span>. Letting <span class="math inline">\(x_1,\ldots, x_k\)</span> denote the number of successes in each category, the prior distribution and likelihood are,</p>
<p><span class="math display">\[
\begin{aligned}
p(\pi_1,\ldots,\pi_k |\alpha_1,\ldots, \alpha_k) = \text{Dirichlet}(\alpha_1,\ldots,\alpha_k) \\
p(x_1,\ldots,x_k | \pi_1,\ldots,\pi_k) = \text{Multin}(n, \pi_1,\ldots,\pi_k).
\end{aligned}
\]</span></p>
</div>
<div id="confidence-intervals-and-standard-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#confidence-intervals-and-standard-errors" class="anchor"></a><span class="header-section-number">4.2</span> Confidence intervals and standard errors</h2>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
